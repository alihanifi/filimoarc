# فصل دوم

در این بخش به تشریح نماهای مختلف از جمله منطقی، استقرار، پیاده‌سازی و غیره پرداخته خواهد شد. در انتها نیز راه‌حل‌های موجود و تکنولوژی‌های متناسب با سامانۀ فیلم‌پلاس بررسی می‌شود.

## نمای منطقی

بررسی نمای منطقی معماری فیلم‌پلاس به کمک نمودار ترتیبی نمایش داده شده در شکل‌های (2) و (3) و (4) انجام شده است. جهت سهولت در فهم، نمودار ترتیبی به سه قسمت تقسیم شده است:

1. نمودار شکل (2) شامل عملیات کاربری و اشتراک است؛ در این نمودار ابتدا ترتیب ثبت‌نام کاربر در سامانه و سپس ورود ایشان نشان داده شده است. سپس یک عملیات خرید اشتراک نمایش داده شده که در آن درخواست خرید اشتراک به پایگاه دادۀ اشتراک، توسط سرویس اطلاعات کاربری صورت می‌پذیرد.

<figure>
    <img id="inlineImg" class="inlImg" onclick="displayImg(this);" src="https://github.com/alihanifi/filmplusarc/blob/main/images/?.png?raw=true" width="400">
    <figcaption>شکل (2): نمودار ترتیبی سامانۀ فیلم‌پلاس - سرویس کاربری</figcaption>
</figure>

2. نمودار شکل (3) شامل عملیات آپلود ویدئو است؛ در این نمودار ترتیب یک عملیات آپلود فایل ویدئویی نشان داده شده است که در آن ابتدا کاربر درخواست خود را به سرویس کد‌گذاری می‌دهد و این سرویس، عملیات مورد نیاز از جمله فشرده‌سازی، تبدیل فرمت و غیره را انجام می‌دهد و فایل را برای ذخیره به CDN ارسال می‌کند. همزمان با این عملیات، اطلاعات متای فیلم نیز در پایگاه‌ دادۀ مربوطه ذخیره می‌گردد.

<figure>
    <img id="inlineImg" class="inlImg" onclick="displayImg(this);" src="https://github.com/alihanifi/filmplusarc/blob/main/images/?.png?raw=true" width="400">
    <figcaption>شکل (3): نمودار ترتیبی سامانۀ فیلم‌پلاس - آپلود ویدئو</figcaption>
</figure>

3. نمودار شکل (4) شامل عملیات جستجو و نمایش فیلم است؛ در این نمودار ابتدا ترتیب یک عملیات جستجو نشان داده شده است که در آن سرویس جستجو اطلاعات موجود در پایگاه‌های دادۀ متا و جستجو ترکیب نموده و سپس به کاربر نمایش می‌دهد. سپس یک ترتیب نمایش ویدئو نشان داده شده است که در آن ابتدا کَش بررسی شده و درصورتیکه فایل‌های مورد نیاز از قبل در کَش وجود داشته باشند، همان برای نمایش بافِر شده و به کاربر ارائه می‌شود؛ درصورتیکه فایل‌ها در کَش موجود نباشند، سرویس ویدئو درخواستی مبنی بر انتقال فایل از S3 به کَش را برای CDN ارسال می‌کند و CDN باتوجه به موقعیت جغرافیایی کاربر و همچنین نحوۀ ذخیره‌سازی فایل‌ها، یکی از مخزن‌های S3 را معرفی نموده و سپس فایل به کَش انتقال پیدا می‌کند. ذکر این نکته حائز اهمیت است که تمامی عملیات انجام شده توسط CDN و S3 به‌صورت فارغ از سامانۀ فیلم‌پلاس انجام می‌شود و فقط به‌عنوان یک سرویس ذخیرۀ فایل از آن استفاده خواهد شد. پس از انتقال فایل به کَش، مجددا فایل برای نمایش آماده‌سازی می‌شود.

<figure>
    <img id="inlineImg" class="inlImg" onclick="displayImg(this);" src="https://github.com/alihanifi/filmplusarc/blob/main/images/?.png?raw=true" width="400">
    <figcaption>شکل (4): نمودار ترتیبی سامانۀ فیلم‌پلاس - جستجو و نمایش ویدئو</figcaption>
</figure>
